openapi: 3.0.3
info:
  title: Automed Healthcare Platform API Gateway
  description: |
    # Automed Healthcare Platform API Gateway

    The API Gateway serves as the single entry point for all client applications accessing the Automed Healthcare Platform.
    It provides advanced routing, security, rate limiting, caching, and observability features.

    ## Key Features

    - **Advanced Routing**: Intelligent request routing with load balancing and failover
    - **Security**: OAuth2/JWT authentication, API key support, rate limiting
    - **Resilience**: Circuit breakers, retries, bulkheads, timeouts
    - **Observability**: Comprehensive metrics, distributed tracing, structured logging
    - **Caching**: Multi-level caching with Redis and in-memory strategies
    - **Health Monitoring**: Real-time health checks and service discovery

    ## Authentication

    All API requests require authentication. The platform supports:

    - **OAuth2/JWT**: Industry-standard token-based authentication
    - **API Keys**: For service-to-service communication
    - **Multi-tenant**: Organization-based access control

    ## Rate Limiting

    Rate limits are enforced based on user roles and API endpoints:

    - **Emergency Services**: Higher limits for critical healthcare operations
    - **Research APIs**: Controlled access for research institutions
    - **Standard Users**: Balanced limits for patient applications

    ## Versioning

    API versioning follows semantic versioning:

    - **v1**: Current stable version
    - **Headers**: `X-API-Version: v1`
    - **Deprecation**: 6-month notice for breaking changes

  version: 2.0.0
  contact:
    name: Automed Platform Team
    email: platform@automed.com
    url: https://automed.com
  license:
    name: Proprietary
    url: https://automed.com/license

servers:
  - url: https://api.automed.com/v1
    description: Production server
  - url: https://staging-api.automed.com/v1
    description: Staging server
  - url: http://localhost:8080/v1
    description: Local development server

security:
  - bearerAuth: []
  - apiKeyAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from authentication service
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for service-to-service authentication

  parameters:
    correlationId:
      name: X-Correlation-ID
      in: header
      description: Unique identifier for request tracing
      required: false
      schema:
        type: string
        format: uuid
    requestId:
      name: X-Request-ID
      in: header
      description: Request identifier for debugging
      required: false
      schema:
        type: string
    apiVersion:
      name: X-API-Version
      in: header
      description: API version requested
      required: false
      schema:
        type: string
        enum: [v1]
        default: v1

  responses:
    BadRequest:
      description: Bad Request - Invalid input parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized - Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Not Found - Resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    TooManyRequests:
      description: Too Many Requests - Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          headers:
            X-Rate-Limit-Remaining:
              description: Number of requests remaining in current window
              schema:
                type: integer
            X-Rate-Limit-Reset:
              description: Time when rate limit resets (Unix timestamp)
              schema:
                type: integer
    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    ErrorResponse:
      type: object
      required:
        - timestamp
        - status
        - error
        - message
        - path
      properties:
        timestamp:
          type: string
          format: date-time
          description: Error timestamp
        status:
          type: integer
          description: HTTP status code
        error:
          type: string
          description: Error type
        message:
          type: string
          description: Human-readable error message
        path:
          type: string
          description: Request path
        correlationId:
          type: string
          description: Request correlation ID for tracing
        details:
          type: object
          description: Additional error details

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [UP, DOWN, OUT_OF_SERVICE, UNKNOWN]
        components:
          type: object
          properties:
            db:
              $ref: '#/components/schemas/HealthComponent'
            redis:
              $ref: '#/components/schemas/HealthComponent'
            downstreamServices:
              type: object
              additionalProperties:
                $ref: '#/components/schemas/HealthComponent'

    HealthComponent:
      type: object
      properties:
        status:
          type: string
          enum: [UP, DOWN, OUT_OF_SERVICE, UNKNOWN]
        details:
          type: object

    MetricsResponse:
      type: object
      description: Prometheus metrics in text format
      example: |
        # HELP http_server_requests_seconds
        # TYPE http_server_requests_seconds histogram
        http_server_requests_seconds_bucket{method="GET",status="200",uri="/api/v1/patients",le="0.1"} 1.0

paths:
  /health:
    get:
      summary: Health Check
      description: Comprehensive health check for all system components
      tags: [Monitoring]
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: System is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /metrics:
    get:
      summary: Prometheus Metrics
      description: Expose application metrics in Prometheus format
      tags: [Monitoring]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Metrics data
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/MetricsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/patients:
    get:
      summary: List Patients
      description: Retrieve paginated list of patients with filtering and sorting
      tags: [Patient Management]
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: sort
          in: query
          schema:
            type: string
            enum: [name,createdAt,updatedAt]
            default: createdAt
        - name: direction
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Patients retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: array
                    items:
                      $ref: '#/components/schemas/Patient'
                  page:
                    type: integer
                  size:
                    type: integer
                  totalElements:
                    type: integer
                  totalPages:
                    type: integer
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

    post:
      summary: Create Patient
      description: Create a new patient record
      tags: [Patient Management]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePatientRequest'
      responses:
        '201':
          description: Patient created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/patients/{id}:
    get:
      summary: Get Patient
      description: Retrieve patient by ID
      tags: [Patient Management]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Patient retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      summary: Update Patient
      description: Update patient information
      tags: [Patient Management]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePatientRequest'
      responses:
        '200':
          description: Patient updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'

    delete:
      summary: Delete Patient
      description: Soft delete a patient record
      tags: [Patient Management]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Patient deleted successfully

  /api/v1/hospitals:
    get:
      summary: List Hospitals
      description: Retrieve paginated list of hospitals
      tags: [Hospital Management]
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: specialty
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Hospitals retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: array
                    items:
                      $ref: '#/components/schemas/Hospital'
                  page:
                    type: integer
                  size:
                    type: integer
                  totalElements:
                    type: integer
                  totalPages:
                    type: integer

  /api/v1/emergency:
    post:
      summary: Create Emergency Alert
      description: Create an emergency alert for immediate response
      tags: [Emergency Services]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmergencyAlertRequest'
      responses:
        '201':
          description: Emergency alert created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmergencyAlert'
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/v1/ai/analyze:
    post:
      summary: AI Medical Analysis
      description: Perform AI-powered medical analysis
      tags: [AI Services]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                patientId:
                  type: string
                  format: uuid
                symptoms:
                  type: array
                  items:
                    type: string
                medicalHistory:
                  type: object
      responses:
        '200':
          description: Analysis completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  diagnosis:
                    type: object
                  confidence:
                    type: number
                    minimum: 0
                    maximum: 1
                  recommendations:
                    type: array
                    items:
                      type: string

  /api/v1/research/projects:
    get:
      summary: List Research Projects
      description: Retrieve research projects (requires research role)
      tags: [Research]
      security:
        - bearerAuth: [research]
      responses:
        '200':
          description: Research projects retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  projects:
                    type: array
                    items:
                      $ref: '#/components/schemas/ResearchProject'

# Remove duplicate components section - schemas are already defined above
    Patient:
      type: object
      required:
        - id
        - patientId
        - firstName
        - lastName
        - dateOfBirth
        - gender
        - email
        - phoneNumber
        - address
        - bloodType
        - status
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        patientId:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
          enum: [MALE, FEMALE, OTHER, PREFER_NOT_TO_SAY]
        email:
          type: string
          format: email
        phoneNumber:
          type: string
        address:
          $ref: '#/components/schemas/Address'
        bloodType:
          type: string
          enum: [A_POSITIVE, A_NEGATIVE, B_POSITIVE, B_NEGATIVE, AB_POSITIVE, AB_NEGATIVE, O_POSITIVE, O_NEGATIVE, UNKNOWN]
        allergies:
          type: array
          items:
            type: string
        medicalConditions:
          type: array
          items:
            type: string
        status:
          type: string
          enum: [ACTIVE, INACTIVE, DECEASED, UNKNOWN]
        emergencyContact:
          $ref: '#/components/schemas/EmergencyContact'
        insurance:
          $ref: '#/components/schemas/Insurance'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Address:
      type: object
      required:
        - street
        - city
        - state
        - country
        - zipCode
      properties:
        street:
          type: string
        city:
          type: string
        state:
          type: string
        country:
          type: string
        zipCode:
          type: string
        latitude:
          type: number
          format: float
        longitude:
          type: number
          format: float

    EmergencyContact:
      type: object
      required:
        - name
        - relationship
        - phoneNumber
      properties:
        name:
          type: string
        relationship:
          type: string
        phoneNumber:
          type: string
        email:
          type: string
          format: email

    Insurance:
      type: object
      required:
        - provider
        - policyNumber
        - groupNumber
        - expiryDate
      properties:
        provider:
          type: string
        policyNumber:
          type: string
        groupNumber:
          type: string
        expiryDate:
          type: string
          format: date

    CreatePatientRequest:
      type: object
      required:
        - firstName
        - lastName
        - dateOfBirth
        - gender
        - email
        - phoneNumber
        - address
        - bloodType
      properties:
        firstName:
          type: string
        lastName:
          type: string
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
          enum: [MALE, FEMALE, OTHER, PREFER_NOT_TO_SAY]
        email:
          type: string
          format: email
        phoneNumber:
          type: string
        address:
          $ref: '#/components/schemas/Address'
        bloodType:
          type: string
          enum: [A_POSITIVE, A_NEGATIVE, B_POSITIVE, B_NEGATIVE, AB_POSITIVE, AB_NEGATIVE, O_POSITIVE, O_NEGATIVE, UNKNOWN]
        allergies:
          type: array
          items:
            type: string
        medicalConditions:
          type: array
          items:
            type: string
        emergencyContact:
          $ref: '#/components/schemas/EmergencyContact'
        insurance:
          $ref: '#/components/schemas/Insurance'

    UpdatePatientRequest:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
          enum: [MALE, FEMALE, OTHER, PREFER_NOT_TO_SAY]
        email:
          type: string
          format: email
        phoneNumber:
          type: string
        address:
          $ref: '#/components/schemas/Address'
        bloodType:
          type: string
          enum: [A_POSITIVE, A_NEGATIVE, B_POSITIVE, B_NEGATIVE, AB_POSITIVE, AB_NEGATIVE, O_POSITIVE, O_NEGATIVE, UNKNOWN]
        allergies:
          type: array
          items:
            type: string
        medicalConditions:
          type: array
          items:
            type: string
        emergencyContact:
          $ref: '#/components/schemas/EmergencyContact'
        insurance:
          $ref: '#/components/schemas/Insurance'
        status:
          type: string
          enum: [ACTIVE, INACTIVE, DECEASED, UNKNOWN]

    Hospital:
      type: object
      required:
        - id
        - name
        - type
        - address
        - phoneNumber
        - specialties
        - status
        - capacity
        - currentOccupancy
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
          enum: [GENERAL, SPECIALTY, TEACHING, PRIVATE, GOVERNMENT]
        address:
          $ref: '#/components/schemas/Address'
        phoneNumber:
          type: string
        email:
          type: string
          format: email
        website:
          type: string
          format: uri
        specialties:
          type: array
          items:
            type: string
        status:
          type: string
          enum: [ACTIVE, INACTIVE, MAINTENANCE, EMERGENCY_ONLY]
        capacity:
          type: integer
        currentOccupancy:
          type: integer
        facilities:
          type: object
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    EmergencyAlertRequest:
      type: object
      required:
        - patientId
        - type
        - severity
        - message
        - location
      properties:
        patientId:
          type: string
          format: uuid
        type:
          type: string
          enum: [CARDIAC_ARREST, RESPIRATORY_DISTRESS, TRAUMA, STROKE, ALLERGIC_REACTION, FALL, OTHER]
        severity:
          type: string
          enum: [LOW, MEDIUM, HIGH, CRITICAL]
        message:
          type: string
        location:
          type: string
        vitals:
          type: object
        metadata:
          type: object

    EmergencyAlert:
      type: object
      required:
        - id
        - patientId
        - type
        - severity
        - message
        - location
        - timestamp
        - status
      properties:
        id:
          type: string
          format: uuid
        patientId:
          type: string
          format: uuid
        hospitalId:
          type: string
          format: uuid
        type:
          type: string
          enum: [CARDIAC_ARREST, RESPIRATORY_DISTRESS, TRAUMA, STROKE, ALLERGIC_REACTION, FALL, OTHER]
        severity:
          type: string
          enum: [LOW, MEDIUM, HIGH, CRITICAL]
        message:
          type: string
        location:
          type: string
        timestamp:
          type: string
          format: date-time
        status:
          type: string
          enum: [PENDING, ACKNOWLEDGED, IN_PROGRESS, RESOLVED, CANCELLED]
        assignedTo:
          type: string
        responseTime:
          type: string
          format: date-time
        metadata:
          type: object

    ResearchProject:
      type: object
      required:
        - id
        - title
        - description
        - type
        - status
        - startDate
        - researchers
        - budget
        - principalInvestigator
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [CANCER_RESEARCH, COMPUTATIONAL_BIOLOGY, MEDICAL_ROBOTICS, MOLECULAR_SIMULATION, TISSUE_ENGINEERING]
        status:
          type: string
          enum: [PLANNING, ACTIVE, PAUSED, COMPLETED, CANCELLED, FAILED]
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        researchers:
          type: array
          items:
            type: string
        budget:
          type: number
          format: float
        principalInvestigator:
          type: string
        progress:
          type: integer
          minimum: 0
          maximum: 100